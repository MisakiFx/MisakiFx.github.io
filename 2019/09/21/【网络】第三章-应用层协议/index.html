<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_16.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="网络,应用层协议," />










<meta name="description" content="应用层协议&amp;emsp;&amp;emsp;在这个章节中将会进一步详细讨论应用层协议及其知名协议HTTP协议。 协议&amp;emsp;&amp;emsp;应用层负责程序之间的数据沟通，其中协议大概分为两类，自定制协议和知名协议。 自定制协议&amp;emsp;&amp;emsp;自定制协议就是程序员自己定义的协议，用来对应用程序发送的数据进行整理或者加密，对端只有了解这种协议才能对数据进行解析。&amp;emsp;&amp;emsp;这里利用自定制简单">
<meta name="keywords" content="网络,应用层协议">
<meta property="og:type" content="article">
<meta property="og:title" content="【网络】第三章-应用层协议">
<meta property="og:url" content="http://yoursite.com/2019/09/21/【网络】第三章-应用层协议/index.html">
<meta property="og:site_name" content="Misaki`s blog">
<meta property="og:description" content="应用层协议&amp;emsp;&amp;emsp;在这个章节中将会进一步详细讨论应用层协议及其知名协议HTTP协议。 协议&amp;emsp;&amp;emsp;应用层负责程序之间的数据沟通，其中协议大概分为两类，自定制协议和知名协议。 自定制协议&amp;emsp;&amp;emsp;自定制协议就是程序员自己定义的协议，用来对应用程序发送的数据进行整理或者加密，对端只有了解这种协议才能对数据进行解析。&amp;emsp;&amp;emsp;这里利用自定制简单">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2019/09/21/【网络】第三章-应用层协议/1.png">
<meta property="og:image" content="http://yoursite.com/2019/09/21/【网络】第三章-应用层协议/2.png">
<meta property="og:image" content="http://yoursite.com/2019/09/21/【网络】第三章-应用层协议/3.png">
<meta property="og:updated_time" content="2019-09-21T10:45:36.879Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【网络】第三章-应用层协议">
<meta name="twitter:description" content="应用层协议&amp;emsp;&amp;emsp;在这个章节中将会进一步详细讨论应用层协议及其知名协议HTTP协议。 协议&amp;emsp;&amp;emsp;应用层负责程序之间的数据沟通，其中协议大概分为两类，自定制协议和知名协议。 自定制协议&amp;emsp;&amp;emsp;自定制协议就是程序员自己定义的协议，用来对应用程序发送的数据进行整理或者加密，对端只有了解这种协议才能对数据进行解析。&amp;emsp;&amp;emsp;这里利用自定制简单">
<meta name="twitter:image" content="http://yoursite.com/2019/09/21/【网络】第三章-应用层协议/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/09/21/【网络】第三章-应用层协议/"/>





  <title>【网络】第三章-应用层协议 | Misaki`s blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

<a href="https://github.com/MisakiFx" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Misaki`s blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习是一种态度</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/21/【网络】第三章-应用层协议/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="MisakiFx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/blog-logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Misaki`s blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">【网络】第三章-应用层协议</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-21T18:24:10+08:00">
                2019-09-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/网络/" itemprop="url" rel="index">
                    <span itemprop="name">网络</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5.1k
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="应用层协议"><a href="#应用层协议" class="headerlink" title="应用层协议"></a>应用层协议</h1><p>&emsp;&emsp;在这个章节中将会进一步详细讨论应用层协议及其知名协议<strong>HTTP</strong>协议。</p>
<h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><p>&emsp;&emsp;应用层负责程序之间的数据沟通，其中协议大概分为两类，自定制协议和知名协议。</p>
<h3 id="自定制协议"><a href="#自定制协议" class="headerlink" title="自定制协议"></a>自定制协议</h3><p>&emsp;&emsp;自定制协议就是程序员自己定义的协议，用来对应用程序发送的数据进行整理或者加密，对端只有了解这种协议才能对数据进行解析。<br>&emsp;&emsp;这里利用自定制简单实现一个网络版计算器。客户端将两个数字和一个运算符传输给服务端，服务端对接收到的信息进行解析，得到数字和运算符运算出结果后将结果返回给客户端。<br>&emsp;&emsp;在开始之前我们要先自定制一个协议方便我们的客户端与服务端之间进行数据通信。<br>&emsp;&emsp;我们可以将一个表达式解析成如下形式再发送给服务端：<code>1 + 1 -&gt; 1; 2; +</code>。这样的协议形式我们只需要让服务端对数据进行相应切割就可以找到两个操作数和运算符，但是解析过程略微繁琐，所以我们还有第二种方式。<br>&emsp;&emsp;我们利用一个整形数据四个字节一个运算符一个字节的特点，一共分配九个字节大小的内存，约定前八个字节存放两个操作数，最后一个字节存放运算符，一起发送到服务端服务端再对发送的数据分块解析也可以得到数据。<br>&emsp;&emsp;第一种方式易于实现，只用发送一个字符串即可，第二种方式可以用内存拷贝的方式实现，不过最方便的还是利用一个结构体。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line">tcp_socket.hpp</span><br><span class="line">/**                                                                                   </span><br><span class="line"> * 封装一个tcpsocket类，向外提供简单接口能够实现客户端服务端编程流程</span><br><span class="line"> * 1、创建套接字                                  </span><br><span class="line"> * 2、绑定地址信息            </span><br><span class="line"> * 3、开始监听/发起连接请求                      </span><br><span class="line"> * 4、获取已完成连接                            </span><br><span class="line"> * 5、发送数据                                                </span><br><span class="line"> * 6、接收数据                 </span><br><span class="line"> * 7、关闭套接字</span><br><span class="line"> **/                                             </span><br><span class="line">                                                </span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;string&gt;            </span><br><span class="line">#include &lt;netinet/in.h&gt;                        </span><br><span class="line">#include &lt;arpa/inet.h&gt;</span><br><span class="line">#include &lt;sys/socket.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;    </span><br><span class="line">#define CHECK_RET(q) if(q == false) &#123;return -1;&#125;</span><br><span class="line">struct calc_t                                     </span><br><span class="line">&#123;                    </span><br><span class="line">  int num1;                                </span><br><span class="line">  int num2;      </span><br><span class="line">  char op;        </span><br><span class="line">&#125;;                                             </span><br><span class="line">class TcpSocket      </span><br><span class="line">&#123;               </span><br><span class="line">  public:         </span><br><span class="line">    TcpSocket()       </span><br><span class="line">    &#123;                                </span><br><span class="line">                       </span><br><span class="line">    &#125;                                                 </span><br><span class="line">    ~TcpSocket() </span><br><span class="line">    &#123;     </span><br><span class="line">      Close();                                 </span><br><span class="line">    &#125;</span><br><span class="line">    //创建套接字</span><br><span class="line">    bool Socket()</span><br><span class="line">    &#123;</span><br><span class="line">      //这里首先创建的时皮条套接字</span><br><span class="line">      _sockfd = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</span><br><span class="line">      if(_sockfd &lt; 0)</span><br><span class="line">      &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;socket error&quot; &lt;&lt; std::endl;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">    //绑定地址信息</span><br><span class="line">    bool Bind(const std::string&amp; ip, uint16_t port)</span><br><span class="line">    &#123;</span><br><span class="line">      struct sockaddr_in addr;</span><br><span class="line">      addr.sin_family = AF_INET;</span><br><span class="line">      addr.sin_port = htons(port);</span><br><span class="line">      addr.sin_addr.s_addr = inet_addr(&amp;ip[0]);</span><br><span class="line">      socklen_t len = sizeof(struct sockaddr_in);</span><br><span class="line">      int ret = bind(_sockfd, (struct sockaddr*)&amp;addr, len);</span><br><span class="line">      if(ret &lt; 0)</span><br><span class="line">      &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;bind error&quot; &lt;&lt; std::endl;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      return true;                                                      </span><br><span class="line">    &#125;</span><br><span class="line">    //服务端开始监听</span><br><span class="line">    bool Listen(int backlog = 5)</span><br><span class="line">    &#123;</span><br><span class="line">      int ret = listen(_sockfd, backlog);</span><br><span class="line">      if(ret &lt; 0)</span><br><span class="line">      &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;listen error&quot; &lt;&lt; std::endl;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">    //连接服务端</span><br><span class="line">    bool Connect(const std::string&amp; ip, uint16_t port)</span><br><span class="line">    &#123;</span><br><span class="line">      int ret;</span><br><span class="line">      struct sockaddr_in addr;</span><br><span class="line">      addr.sin_family = AF_INET;</span><br><span class="line">      addr.sin_port = htons(port);</span><br><span class="line">      addr.sin_addr.s_addr = inet_addr(&amp;ip[0]);</span><br><span class="line">      socklen_t len = sizeof(struct sockaddr_in);</span><br><span class="line">      ret = connect(_sockfd, (struct sockaddr*)&amp;addr, len);</span><br><span class="line">      if(ret &lt; 0)</span><br><span class="line">      &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;connet error&quot; &lt;&lt; std::endl;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">    //设置套接字</span><br><span class="line">    void SetFd(int fd)</span><br><span class="line">    &#123;</span><br><span class="line">      _sockfd = fd;</span><br><span class="line">    &#125;</span><br><span class="line">    //获取新的套接字                                                             </span><br><span class="line">    bool Accept(TcpSocket&amp; newsock)</span><br><span class="line">    &#123;</span><br><span class="line">      struct sockaddr_in addr;</span><br><span class="line">      socklen_t len = sizeof(struct sockaddr_in);</span><br><span class="line">      //这里fd是皮条套接字新创建出来的连接套接字</span><br><span class="line">      int fd = accept(_sockfd, (struct sockaddr*)&amp;addr, &amp;len);</span><br><span class="line">      if(fd &lt; 0)</span><br><span class="line">      &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;accept error&quot; &lt;&lt; std::endl;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      //newsock._sockfd = fd;</span><br><span class="line">      newsock.SetFd(fd);</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">    //发送数据</span><br><span class="line">    bool Send(void* buf, int len)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      int ret = send(_sockfd, buf, len, 0);</span><br><span class="line">      if(ret &lt; 0)</span><br><span class="line">      &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;send error&quot; &lt;&lt; std::endl;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">    bool Send(const std::string&amp; buf)</span><br><span class="line">    &#123;                                                                     </span><br><span class="line">      int ret = send(_sockfd, &amp;buf[0], buf.size(), 0);</span><br><span class="line">      if(ret &lt; 0)</span><br><span class="line">      &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;send error&quot; &lt;&lt; std::endl;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">    //接收数据</span><br><span class="line">    bool Recv(void* buf, int len)</span><br><span class="line">    &#123;</span><br><span class="line">      int ret = recv(_sockfd, buf, len, 0);</span><br><span class="line">      if(ret &lt; 0)</span><br><span class="line">      &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;recv error&quot; &lt;&lt; std::endl;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      else if(ret == 0)</span><br><span class="line">      &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;peer shutdown&quot; &lt;&lt; std::endl;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">    bool Recv(std::string&amp; buf)</span><br><span class="line">    &#123;</span><br><span class="line">      char tmp[4096] = &#123;0&#125;;</span><br><span class="line">      int ret = recv(_sockfd, &amp;tmp[0], 4096, 0);</span><br><span class="line">      if(ret &lt; 0)</span><br><span class="line">      &#123;                                                                 </span><br><span class="line">        std::cerr &lt;&lt; &quot;recv error&quot; &lt;&lt; std::endl;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      else if(ret == 0)</span><br><span class="line">      &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;peer shutdown&quot; &lt;&lt; std::endl;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      buf = tmp;</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">    //关闭</span><br><span class="line">    bool Close()</span><br><span class="line">    &#123;</span><br><span class="line">      if(_sockfd &gt;= 0)</span><br><span class="line">      &#123;</span><br><span class="line">        close(_sockfd);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  private:</span><br><span class="line">    int _sockfd;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">tcp_cli.cpp</span><br><span class="line">#include &quot;tcp_socket.hpp&quot;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">/**</span><br><span class="line"> * 实现客户端</span><br><span class="line"> * 1、创建套接字</span><br><span class="line"> * 2、绑定地址信息（客户端不需要手动绑定）</span><br><span class="line"> * 3、向服务端发起连接请求</span><br><span class="line"> * 4、发送数据</span><br><span class="line"> * 5、接收数据</span><br><span class="line"> * 6、关闭套接字</span><br><span class="line"> **/</span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">  if(argc != 3)</span><br><span class="line">  &#123;</span><br><span class="line">    std::cerr &lt;&lt; &quot;./tcp_cli srvip srvport&quot; &lt;&lt; std::endl;</span><br><span class="line">    return -1;</span><br><span class="line">  &#125;</span><br><span class="line">  TcpSocket sock;</span><br><span class="line">  CHECK_RET(sock.Socket());</span><br><span class="line">  std::string ip = argv[1];</span><br><span class="line">  uint16_t port = atoi(argv[2]);</span><br><span class="line">  CHECK_RET(sock.Connect(ip, port));</span><br><span class="line">  while(1)</span><br><span class="line">  &#123;</span><br><span class="line">    calc_t tmp;</span><br><span class="line">    tmp.num1 = 11;                                      </span><br><span class="line">    tmp.num2 = 22;</span><br><span class="line">    tmp.op = &apos;+&apos;;</span><br><span class="line">    sock.Send((void*)&amp;tmp, sizeof(calc_t));</span><br><span class="line">  &#125;</span><br><span class="line">  sock.Close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">tcp_srv.cpp</span><br><span class="line">/**                                                                                </span><br><span class="line"> * 服务端实现</span><br><span class="line"> * 1、创建套接字</span><br><span class="line"> * 2、绑定地址信息</span><br><span class="line"> * 3、开始监听</span><br><span class="line"> * 4、获取新连接</span><br><span class="line"> * 5、接收数据</span><br><span class="line"> * 6、发送数据</span><br><span class="line"> * 7、关闭套接字</span><br><span class="line"> **/</span><br><span class="line">#include &quot;tcp_socket.hpp&quot;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">  if(argc != 3)</span><br><span class="line">  &#123;</span><br><span class="line">    std::cerr &lt;&lt; &quot;./tcp_srv 192.169.11.128 9000&quot; &lt;&lt; std::endl;</span><br><span class="line">    return -1;</span><br><span class="line">  &#125;</span><br><span class="line">  std::string ip = argv[1];</span><br><span class="line">  uint16_t port = atoi(argv[2]);</span><br><span class="line">  TcpSocket sock;</span><br><span class="line">  CHECK_RET(sock.Socket());</span><br><span class="line">  CHECK_RET(sock.Bind(ip, port));</span><br><span class="line">  CHECK_RET(sock.Listen());</span><br><span class="line">  //这个新的套接字要放在循环外部，否则一次循环结束变量销毁会关闭套接字连接就会断开</span><br><span class="line">  TcpSocket newsock;</span><br><span class="line">  while(1)</span><br><span class="line">  &#123;</span><br><span class="line">    bool ret = sock.Accept(newsock);</span><br><span class="line">    if(ret == false)</span><br><span class="line">    &#123;</span><br><span class="line">      continue;</span><br><span class="line">    &#125;</span><br><span class="line">    calc_t buf;</span><br><span class="line">    ret = newsock.Recv((void*)&amp;buf, sizeof(calc_t));</span><br><span class="line">    if(ret == false)</span><br><span class="line">    &#123;</span><br><span class="line">      std::cerr &lt;&lt; &quot;Recv error&quot; &lt;&lt; std::endl;</span><br><span class="line">      return -1;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; buf.num1 &lt;&lt; &quot; &quot; &lt;&lt; buf.num2 &lt;&lt; &quot; &quot; &lt;&lt; buf.op &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">  sock.Close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[misaki@localhost netbase]$ ./tcp_srv 192.168.11.128 9000</span><br><span class="line">11 22 +</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;我们的服务端就收到了指定的数据信息。<br>&emsp;&emsp;在对于自定制协议的使用中有两条重要概念，序列化与反序列化。<br>&emsp;&emsp;序列化：将数据对象按照指定协议在内存中进行排布成为可持久化存储。<br>&emsp;&emsp;反序列化：将数据传按照指定的协议进行解析得到各个数据对象。<br>&emsp;&emsp;对于序列化与反序列化有几种常用工具。<code>json序列化,protobuf序列化,二进制序列化</code>。</p>
<h3 id="知名协议-HTTP协议"><a href="#知名协议-HTTP协议" class="headerlink" title="知名协议(HTTP协议)"></a>知名协议(HTTP协议)</h3><p>&emsp;&emsp;应用层知名协议有很多不过最常用的就是<code>HTTP</code>协议。在HTTP协议中包含一个重要信息<strong>统一资源定位符(URL)</strong>，URL中又包含哪些信息呢？</p>
<h4 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h4><p>&emsp;&emsp;其实URL就是我们常说的网址。<br>&emsp;&emsp;在URL中有登录信息，服务器地址端口号，文件地址信息，查询字符串和片段标识符。<br>&emsp;&emsp;这里给出一篇博客对URL的组成形式进行了讲解。<br><br>&emsp;&emsp;<a href="https://www.jianshu.com/p/406d19dfabd3" target="_blank" rel="noopener">https://www.jianshu.com/p/406d19dfabd3</a><br><br>&emsp;&emsp;在URL中要注意的是文件地址信息以<code>？</code>结束往后的是查询字符串及片段标识符这两个信息。<br>&emsp;&emsp;查询字符串是客户端提交给服务器的数据。<strong>查询字符串是一个个<code>key=val</code>的键值对，并且以<code>&amp;</code>作为间隔，以<code>#</code>作为结尾</strong>。并且提交的数据中不能出现特殊字符，因为会和URL中的分隔符造成二义，造成URL解析失败，因此若提交的数据中有特殊字符就必须进行转义。在URL中如果字符前出现了<code>%</code>则认为这个字符经过了URL的转码。URL转码规则为将需要转码的字符转为16进制，然后从右到左，取4位(不足4位直接处理)，每2位做一位，前面加上%，编码成%XY 格式。片段标识符是对资源的补充，可以理解为书签。</p>
<h4 id="HTTP协议格式"><a href="#HTTP协议格式" class="headerlink" title="HTTP协议格式"></a>HTTP协议格式</h4><p>&emsp;&emsp;<code>HTTP</code>协议分为以下几个大的组成部分。</p>
<h5 id="1、首行"><a href="#1、首行" class="headerlink" title="1、首行"></a>1、首行</h5><p>&emsp;&emsp;首行又分为请求首行和响应首行。<br>&emsp;&emsp;<strong>请求首行格式</strong>：<code>请求方法 URL 协议版本\r\n</code>。<br>&emsp;&emsp;请求方法有很多，其中常用的有<code>GET/POST</code>方法。<code>GET</code>方法多用于向服务器请求资源，不过也可以提交数据，只不过提交的数据在查询字符串中以明文方式传输，十分不安全并且长度有限。<code>POST</code>方法是专门用于向服务器提交表单数据的，提交的数据在正文中。除此之外还有很多种请求方法，<code>HEAD/PUT/DELETE/CONNECT/OPTIONS/TRACE/PATCH</code>，这里简单介绍几个。<br>&emsp;&emsp;<code>HEAD</code>请求方法和<code>GET</code>一样是向服务器请求资源，不过<code>HEAD</code>请求只会接收服务器的回复中的首行及头部信息，而不要正文信息。<br>&emsp;&emsp;<code>PUT</code>请求会用正文信息替代服务端指定文件中的数据。<br>&emsp;&emsp;<code>DELETE</code>是删除服务器指定文件。<br>&emsp;&emsp;URL已经介绍过。关于协议版本目前常见的有<code>http/0.9 http/1.0 http/1.1 http/2</code>。0.9版本是<code>HTTP</code>最早期的协议，只有一个<code>GET</code>方法，用于向服务器获取数据展示<code>HTML</code>文件。并且0.9版本的连接是短连接，客户端向服务端建立连接发送请求，服务端应答完毕就会关闭套接字。与之对应的是长连接，即一轮信息交互后不会关闭客户端，可以继续通信，这样就不用频繁建立套接字，这个长连接在1.0版本中得以实现，但是这个长连接还是一来一回的连接方式，并且在1.0版本中默认关闭长连接，需要在头部信息中开启，在这个版本中还加入了<code>POST</code>和<code>HEAD</code>方法。之后便是1.1版本，并且是现在最常用的版本，这个版本中长连接默认开启，并且使用了管线化连接方式，即客户端可以连续发送多个请求，服务端一一进行回复，更加灵活方便，在这个版本中还将请求方法增加到现在的9个方法。<br>&emsp;&emsp;<strong>响应首行格式</strong>：<code>协议版本 响应状态码 响应状态码描述\r\n</code><br>&emsp;&emsp;协议版本与请求首行中的协议版本是一样的。这里着重介绍响应状态码。<br>&emsp;&emsp;响应状态码是服务端对请求处理结果的表述，一共分为五大类：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1xx:表示描述性信息</span><br><span class="line">2xx:处理正确响应，如200表示请求已经正确处理完毕</span><br><span class="line">3xx:表示重定向，如301永久重定向，302临时重定向。</span><br><span class="line">                永久重定向指下次如果还请求此路径则直接访问重定向之后的网址，不再请求原网址</span><br><span class="line">                临时重定向表示知识临时重定向到新网址，下次访问还是先访问原网址</span><br><span class="line">4xx:客户端错误，如404请求资源未找到，400请求格式有误</span><br><span class="line">5xx:服务端错误，如502网关错误，500服务器内部错误。</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;响应状态码描述就是对响应状态码响应的文字描述信息。</p>
<h5 id="2、头部"><a href="#2、头部" class="headerlink" title="2、头部"></a>2、头部</h5><p>&emsp;&emsp;头部是以一个一个键值对的形式存在的，格式<code>key: value</code>，标识着连接的属性和一些信息。一对键值对独占有一行，以<code>\r\n</code>作为结尾。这里简单介绍几种头信息，但其实头信息非常非常的多。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//请求头部：</span><br><span class="line">Connection:开启/关闭长连接</span><br><span class="line">Content-Length:正文长度</span><br><span class="line">Content-Type:正文数据类型，有很多类型，包括图片，HTML超文本等</span><br><span class="line">User-Agent:浏览器版本信息及系统版本信息</span><br><span class="line">Accept:告诉服务端自己可以接收哪些数据</span><br><span class="line">Accept-Encoding:能接收的数据编码</span><br><span class="line">Cookie:向服务端发送当前用户的Cookie信息即sessionid</span><br><span class="line">//响应头部：</span><br><span class="line">Server:服务端版本信息</span><br><span class="line">Date:事件</span><br><span class="line">Content-Type:正文数据类型</span><br><span class="line">Transfer-Encoding:传输格式，如果为chunked表示为分块传输，此时每个分块的大小写在正文第一行，最后一个分块大小为0</span><br><span class="line">Location:重定向后的新位置</span><br><span class="line">Set-Coolie:向客户端发送属于当前用户的Cookie信息即sessionid，还有一些其他信息，如Cookie超时失效日期</span><br><span class="line">Referer:从哪个页面跳转到当前页面</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;在请求头部和响应头部中都有关于<code>Cookie</code>的属性信息，那么什么是<code>Cookie</code>？这里举个例子，假如说我们在网上购物，此时我们看中一件商品要将其加入购物车，因此为了区分用户需要进行登录，那么本次请求就是加入购物车请求我们需要登录一次，然后请求成功了，随后我们想要购买购物车中的商品，但是HTTP协议是无状态协议，本次请求与上次请求无任何关系，于是为了购买我们不得不再登陆一次，才能确认我们用户的身份，我们每次进行用户操作都要进行登录，十分麻烦。<br>&emsp;&emsp;之后大佬们想要让HTTP协议能够进行状态维持，于是加入了<code>Cookie</code>帮助我们临时保存一些验证信息，于是情况就改变了。在我们第一次登录完毕后，服务端会在服务器内为客户端建立一个会话，生成一个会话id(<code>sessionid</code>)，并将会话id和用户信息保存起来，此时服务端会给客户端一个响应，响应信息的头部中就会有<code>Set-Cookie</code>信息，其中存储着<code>sessionid</code>和一些其他相关信息例如超时失效信息。客户端在收到服务端的<code>sessionid</code>信息后会将信息保存在浏览器自己的<code>Cookie</code>文件中，在下次再向服务器发信息时会先将与这个服务器对应的<code>Cookie</code>文件中的信息全部读出放入请求信息中，这个信息就存放在请求头部的<code>Cookie</code>中，其中主要就是<code>sessionid</code>。在服务端获取<code>sessionid</code>后就能通过这个id找到对应用户的用户信息，从而避免需要重复登录的情况发生。<br>&emsp;&emsp;这里还要关注一个问题<code>Cookie</code>与<code>session</code>的区别是什么？<code>Cookie</code>是保存在客户端的，每次发起请求时会发送给服务端去寻找属于当前用户的<code>session</code>；而<code>session</code>是保存在服务端的，是为每个用户创建的一个会话，其中保存着对应的<code>sessionid</code>和用户信息。</p>
<h5 id="3、正文"><a href="#3、正文" class="headerlink" title="3、正文"></a>3、正文</h5><p>&emsp;&emsp;在头部与正文之间用一个空行作为间隔，<code>\r\n\r\n</code>即表示一个空行，当遇到两个连续的<code>\r\n</code>时则认为头部结束了。正文则是一些数据信息。</p>
<h4 id="实现HTTP协议服务器"><a href="#实现HTTP协议服务器" class="headerlink" title="实现HTTP协议服务器"></a>实现HTTP协议服务器</h4><p>&emsp;&emsp;不管什么信息发送至服务端，服务端同一回复<code>学习是一种态度</code>。<br>&emsp;&emsp;HTTP服务器实际上是一个TCP服务器，接收到数据后打印出接收的数据，然后统一按照HTTP协议格式回复信息即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 实现一个简单的http服务器</span><br><span class="line"> * 这个代码用到了我们之前封装额tcp头文件</span><br><span class="line"> **/</span><br><span class="line">#include &quot;tcp_socket.hpp&quot;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;sstream&gt;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  TcpSocket sock;</span><br><span class="line">  CHECK_RET(sock.Socket());</span><br><span class="line">  CHECK_RET(sock.Bind(&quot;0.0.0.0&quot;, 9000));</span><br><span class="line">  CHECK_RET(sock.Listen());</span><br><span class="line">  while(1)</span><br><span class="line">  &#123;</span><br><span class="line">    TcpSocket cliSock;</span><br><span class="line">    if(sock.Accept(cliSock) == false)</span><br><span class="line">    &#123;</span><br><span class="line">      continue;</span><br><span class="line">    &#125;</span><br><span class="line">    std::string buf;</span><br><span class="line">    cliSock.Recv(buf);</span><br><span class="line">    std::cout &lt;&lt; &quot;req:[&quot; &lt;&lt; buf &lt;&lt; &quot;]&quot; &lt;&lt; std::endl;;</span><br><span class="line">    std::string body = &quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;学习是一种态度&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;;</span><br><span class="line">    body += &quot;&lt;meta http-equiv=&apos;content-type&apos; content=&apos;text/html;charset=utf-8&apos;&gt;&quot;;</span><br><span class="line">    std::string first = &quot;HTTP/1.1 200 OK&quot;;</span><br><span class="line">    std::stringstream ss;</span><br><span class="line">    ss &lt;&lt; &quot;Content-Length: &quot; &lt;&lt; body.size() &lt;&lt; &quot;\r\n&quot;;</span><br><span class="line">    ss &lt;&lt; &quot;Content-Type: &quot; &lt;&lt; &quot;text/html&quot; &lt;&lt; &quot;\r\n&quot;;</span><br><span class="line">    std::string head = ss.str();</span><br><span class="line">    std::string blank = &quot;\r\n&quot;;</span><br><span class="line">    cliSock.Send(first);</span><br><span class="line">    cliSock.Send(head);</span><br><span class="line">    cliSock.Send(blank);</span><br><span class="line">    cliSock.Send(body);</span><br><span class="line">    cliSock.Close();</span><br><span class="line">  &#125;</span><br><span class="line">  sock.Close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;我们用浏览器访问我们的服务器，服务端会打出以下数据。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[misaki@localhost httpserver]$ ./httpserver </span><br><span class="line">req:[GET / HTTP/1.1</span><br><span class="line">Host: 192.168.11.128:9000</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh,zh-TW;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">req:[GET /favicon.ico HTTP/1.1</span><br><span class="line">Host: 192.168.11.128:9000</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36</span><br><span class="line">Accept: image/webp,image/apng,image/*,*/*;q=0.8</span><br><span class="line">Referer: http://192.168.11.128:9000/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh,zh-TW;q=0.9,en-US;q=0.8,en;q=0.7</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;由于我们打印了客户端发来的数据所以我们可以看到很多http请求数据。浏览器也会显示以下页面。<br><br><img src="/2019/09/21/【网络】第三章-应用层协议/1.png" alt="http"><br><br>&emsp;&emsp;之后我们更改一下代码，用一下重定向。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/**                                                                                   </span><br><span class="line"> * 实现一个简单的http服务器</span><br><span class="line"> **/                     </span><br><span class="line">#include &quot;tcp_socket.hpp&quot;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;sstream&gt;</span><br><span class="line">int main()</span><br><span class="line">&#123;                </span><br><span class="line">  TcpSocket sock;          </span><br><span class="line">  CHECK_RET(sock.Socket());             </span><br><span class="line">  CHECK_RET(sock.Bind(&quot;0.0.0.0&quot;, 9000));</span><br><span class="line">  CHECK_RET(sock.Listen());</span><br><span class="line">  while(1)</span><br><span class="line">  &#123;                   </span><br><span class="line">    TcpSocket cliSock;               </span><br><span class="line">    if(sock.Accept(cliSock) == false)</span><br><span class="line">    &#123;          </span><br><span class="line">      continue;</span><br><span class="line">    &#125;               </span><br><span class="line">    std::string buf;  </span><br><span class="line">    cliSock.Recv(buf);                               </span><br><span class="line">    std::cout &lt;&lt; &quot;req:[&quot; &lt;&lt; buf &lt;&lt; &quot;]&quot; &lt;&lt; std::endl;;                      </span><br><span class="line">    std::string body = &quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;学习是一种态度&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;;      </span><br><span class="line">    body += &quot;&lt;meta http-equiv=&apos;content-type&apos; content=&apos;text/html;charset=utf-8&apos;&gt;&quot;;</span><br><span class="line">    //std::string first = &quot;HTTP/1.1 200 OK&quot;;</span><br><span class="line">    //这类改为重定向                      </span><br><span class="line">    std::string first = &quot;HTTP/1.1 302 OK&quot;;</span><br><span class="line">    std::stringstream ss;                             </span><br><span class="line">    ss &lt;&lt; &quot;Content-Length: &quot; &lt;&lt; body.size() &lt;&lt; &quot;\r\n&quot;;</span><br><span class="line">    ss &lt;&lt; &quot;Content-Type: &quot; &lt;&lt; &quot;text/html&quot; &lt;&lt; &quot;\r\n&quot;;</span><br><span class="line">    ss &lt;&lt; &quot;Location: http://www.taobao.com/\r\n&quot;;</span><br><span class="line">    std::string head = ss.str();</span><br><span class="line">    std::string blank = &quot;\r\n&quot;;</span><br><span class="line">    cliSock.Send(first);</span><br><span class="line">    cliSock.Send(head);</span><br><span class="line">    cliSock.Send(blank);</span><br><span class="line">    cliSock.Send(body);</span><br><span class="line">    cliSock.Close();</span><br><span class="line">  &#125;</span><br><span class="line">  sock.Close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;再次使用浏览器访问，则会跳转到淘宝页面。<br><br><img src="/2019/09/21/【网络】第三章-应用层协议/2.png" alt="http"><br><br>&emsp;&emsp;之后我们再次更改代码，这次使用404状态码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 实现一个简单的http服务器</span><br><span class="line"> **/</span><br><span class="line">#include &quot;tcp_socket.hpp&quot;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;sstream&gt;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  TcpSocket sock;</span><br><span class="line">  CHECK_RET(sock.Socket());</span><br><span class="line">  CHECK_RET(sock.Bind(&quot;0.0.0.0&quot;, 9000));</span><br><span class="line">  CHECK_RET(sock.Listen());</span><br><span class="line">  while(1)</span><br><span class="line">  &#123;</span><br><span class="line">    TcpSocket cliSock;</span><br><span class="line">    if(sock.Accept(cliSock) == false)</span><br><span class="line">    &#123;</span><br><span class="line">      continue;</span><br><span class="line">    &#125;</span><br><span class="line">    std::string buf;</span><br><span class="line">    cliSock.Recv(buf);</span><br><span class="line">    std::cout &lt;&lt; &quot;req:[&quot; &lt;&lt; buf &lt;&lt; &quot;]&quot; &lt;&lt; std::endl;;</span><br><span class="line">    std::string body = &quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;学习是一种态度&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;;</span><br><span class="line">    body += &quot;&lt;meta http-equiv=&apos;content-type&apos; content=&apos;text/html;charset=utf-8&apos;&gt;&quot;;</span><br><span class="line">    //std::string first = &quot;HTTP/1.1 200 OK&quot;;</span><br><span class="line">    //这类改为重定向</span><br><span class="line">    //std::string first = &quot;HTTP/1.1 302 OK&quot;;</span><br><span class="line">    //这次改为客户端错误</span><br><span class="line">    std::string first = &quot;HTTP/1.1 404 OK&quot;;                                           </span><br><span class="line">    std::stringstream ss;</span><br><span class="line">    ss &lt;&lt; &quot;Content-Length: &quot; &lt;&lt; body.size() &lt;&lt; &quot;\r\n&quot;;</span><br><span class="line">    ss &lt;&lt; &quot;Content-Type: &quot; &lt;&lt; &quot;text/html&quot; &lt;&lt; &quot;\r\n&quot;;</span><br><span class="line">    ss &lt;&lt; &quot;Location: http://www.taobao.com/\r\n&quot;;</span><br><span class="line">    std::string head = ss.str();</span><br><span class="line">    std::string blank = &quot;\r\n&quot;;</span><br><span class="line">    cliSock.Send(first);</span><br><span class="line">    cliSock.Send(head);</span><br><span class="line">    cliSock.Send(blank);</span><br><span class="line">    cliSock.Send(body);</span><br><span class="line">    cliSock.Close();</span><br><span class="line">  &#125;</span><br><span class="line">  sock.Close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;还是使用浏览器访问显示以下画面。<br><img src="/2019/09/21/【网络】第三章-应用层协议/3.png" alt="http"><br><br>&emsp;&emsp;我们的返回状态码是404为什么也可以显示页面？浏览器默认错误页面是可以自定制的，我们这里返回的相当于是一个错误页面，于是浏览器也帮我们显示了出来。<br>&emsp;&emsp;其他状态码这里就不一一演示了。</p>

      
    </div>
    
    
    

    

    <div>
    
    <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读!-------------</div>
    
    </div>

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>记录学习每一分，感谢您的赞助</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="MisakiFx 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="MisakiFx 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/网络/" rel="tag"># 网络</a>
          
            <a href="/tags/应用层协议/" rel="tag"># 应用层协议</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/09/16/【网络】第二章-套接字编程/" rel="next" title="【网络】第二章-套接字编程">
                <i class="fa fa-chevron-left"></i> 【网络】第二章-套接字编程
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/09/22/【网络】第四章-传输层协议/" rel="prev" title="【网络】第四章-传输层协议">
                【网络】第四章-传输层协议 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/blog-logo.jpg"
                alt="MisakiFx" />
            
              <p class="site-author-name" itemprop="name">MisakiFx</p>
              <p class="site-description motion-element" itemprop="description">Hard working or giving up!!!</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">76</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">53</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/MisakiFx" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:1761607418@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope-open"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://music.163.com/#/user/home?id=432551242" target="_blank" title="网易云音乐">
                      
                        <i class="fa fa-fw fa-music"></i>网易云音乐</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/qq_41669298" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-crosshairs"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#应用层协议"><span class="nav-number">1.</span> <span class="nav-text">应用层协议</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#协议"><span class="nav-number">1.1.</span> <span class="nav-text">协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自定制协议"><span class="nav-number">1.1.1.</span> <span class="nav-text">自定制协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#知名协议-HTTP协议"><span class="nav-number">1.1.2.</span> <span class="nav-text">知名协议(HTTP协议)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#URL"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">URL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP协议格式"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">HTTP协议格式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1、首行"><span class="nav-number">1.1.2.2.1.</span> <span class="nav-text">1、首行</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2、头部"><span class="nav-number">1.1.2.2.2.</span> <span class="nav-text">2、头部</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3、正文"><span class="nav-number">1.1.2.2.3.</span> <span class="nav-text">3、正文</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实现HTTP协议服务器"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">实现HTTP协议服务器</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        ﻿<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">MisakiFx</span>

  
</div>


<div class="powered-by">
  <i class="fa fa-user-md"></i>
  <span id="busuanzi_container_site_uv">
    我的网站的访客数:<span id="busuanzi_value_site_uv"></span>
  </span>
</div>



<span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共231.8k字</span>
</div>

        ﻿







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

  <!-- 页面点击小红心 -->
        <script type="text/javascript" src="/js/src/love.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
